<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

	    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" type="text/css" />
	    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	    <script src="http://underscorejs.org/underscore-min.js"></script>
	    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

	    <style>

	    	svg {
	    		margin: 20px;
	    		height: 500px;
	    		display: block;
	    		width: 20000px;
	    	}
	    </style>
	</head>

	<body>

		<svg>

		</svg>

		<script>
		d3.csv('bart-comp-all.csv', function(response) {
			var employeeData = response;
			var groupedByPosition = _.groupBy(employeeData, function(employee) {
				return employee.Title;
			});
			groupedByPosition = _.values(groupedByPosition);

			var svg = d3.select('svg');

			var colorScale = d3.scale.category20();
			console.log(groupedByPosition)
			svg.selectAll('rect')
				.data(groupedByPosition)
				.enter().append('rect')
					.attr('x', function(d, i) {
						return i * 10;
					}).attr('y', 0)
					.attr('width', 10)
					.attr('height', function(employees, i) {
						var sum = 0;
						var length = employees.length;

						_.each(employees, function(employee) {
							sum = sum + parseInt(employee.Base);
						});
						return sum / length / 1000;
					}).attr('fill', function(employees) {
						return colorScale(employees[0]["Union"]);
					}).append('title')
						.text(function(employees) {
							return employees[0].Title;
						});

		});
		</script>
	</body>

</html>