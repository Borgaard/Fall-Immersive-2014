<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

	    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" type="text/css" />
	    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	    <script src="http://underscorejs.org/underscore-min.js"></script>
	    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

	    <style>

	    	svg {
	    		margin: 20px;
	    		height: 500px;
	    		display: block;
	    		width: 20000px;
	    	}
	    </style>
	</head>

	<body>

		<svg>

		</svg>

		<script>
		d3.csv('bart-comp-all.csv', function(response) {
			var employeeData = response;
			var groupedByPosition = _.groupBy(employeeData, function(employee) {
				return employee.Title;
			});
			groupedByPosition = _.map(groupedByPosition, function(employees) {
				var length = employees.length;
				var sum = _.reduce(employees, function(memo, employee) {
					return memo + parseInt(employee.Base);
				}, 0)
				return {
					base: sum / length,
					employees: employees
				}
			});

			var svg = d3.select('svg');



			force.on("tick", function(e) {
			  var q = d3.geom.quadtree(nodes),
			      i = 0,
			      n = nodes.length;

			  while (++i < n) q.visit(collide(nodes[i]));

			});

			function collide(node) {
			  var r = node.radius + 16,
			      nx1 = node.x - r,
			      nx2 = node.x + r,
			      ny1 = node.y - r,
			      ny2 = node.y + r;
			  return function(quad, x1, y1, x2, y2) {
			    if (quad.point && (quad.point !== node)) {
			      var x = node.x - quad.point.x,
			          y = node.y - quad.point.y,
			          l = Math.sqrt(x * x + y * y),
			          r = node.radius + quad.point.radius;
			      if (l < r) {
			        l = (l - r) / l * .5;
			        node.x -= x *= l;
			        node.y -= y *= l;
			        quad.point.x += x;
			        quad.point.y += y;
			      }
			    }
			    return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
			  };
			}



		});
		</script>
	</body>

</html>